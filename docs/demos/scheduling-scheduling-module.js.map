{"version":3,"sources":["./apps/demos/src/app/features/concepts/scheduling/scheduling/utils/index.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling.routes.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling/utils/priority-tick-map.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling.module.ts","./apps/demos/src/app/shared/debug-helper/visualizer/index.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling/utils/interfaces.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling/utils/animationFrameTick.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling/utils/promiseTick.ts","./apps/demos/src/app/features/concepts/scheduling/scheduling/scheduling.component.ts"],"names":[],"mappings":"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","file":"scheduling-scheduling-module.js","sourcesContent":["export * from './promiseTick';\nexport * from './animationFrameTick';\nexport * from './interfaces';\nexport * from './priority-tick-map';\n","import { SchedulingComponent } from './scheduling/scheduling.component';\n\nexport const ROUTES = [\n  {\n    path: '',\n    component: SchedulingComponent\n  }\n];\n","import { animationFrameTick } from './animationFrameTick';\nimport { promiseTick } from './promiseTick';\nimport { SchedulingPriority } from './interfaces';\nimport { intervalTick, timeoutTick } from '../../../../../rx-angular-pocs/cdk/utils/rxjs/observable';\n\nexport const priorityTickMap = {\n  [SchedulingPriority.animationFrame]: animationFrameTick(),\n  [SchedulingPriority.Promise]: promiseTick(),\n  [SchedulingPriority.setInterval]: intervalTick(),\n  [SchedulingPriority.setTimeout]: timeoutTick(),\n};\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { SchedulingComponent } from './scheduling/scheduling.component';\nimport { LetModule, PushModule, UnpatchEventsModule } from '@rx-angular/template';\nimport { ROUTES } from './scheduling.routes';\nimport { MatButtonModule } from '@angular/material/button';\nimport { VisualizerModule } from '../../../shared/debug-helper/visualizer';\n\nconst DECLARATIONS = [SchedulingComponent];\n\n@NgModule({\n  declarations: [DECLARATIONS],\n  imports: [\n    CommonModule,\n    RouterModule.forChild(ROUTES),\n    LetModule, PushModule, UnpatchEventsModule,\n    MatButtonModule,\n    VisualizerModule\n  ],\n  exports: [DECLARATIONS]\n})\nexport class SchedulingModule {}\n","export {VisualizerModule} from './visualizer.module';\nexport {VisualizerComponent} from './visualizer/visualizer.component';\n","export enum SchedulingName {\n  animationFrame = 'animationFrame',\n  Promise = 'Promise',\n  idleCallback = 'idleCallback',\n  userBlocking = 'userBlocking',\n  userVisible = 'userVisible',\n  background = 'background',\n  setInterval = 'setInterval',\n}\n\n\nexport enum SchedulingPriority {\n  sync,\n  animationFrame,\n  Promise,\n  setTimeout,\n  setInterval,\n  postMessage,\n  idleCallback,\n  userBlocking,\n  userVisible,\n  background\n}\n\n","import { Observable } from 'rxjs';\nimport { getZoneUnPatchedApi } from '@rx-angular/cdk';\n\nexport const animationFrameTick = () =>\n  new Observable<number>((subscriber) => {\n    const id = getZoneUnPatchedApi('requestAnimationFrame')(() => {\n      subscriber.next(0);\n      subscriber.complete();\n    });\n\n    return () => {\n      getZoneUnPatchedApi('cancelAnimationFrame')(id);\n    };\n  });\n","import { Observable } from 'rxjs';\nimport { Promise } from '@rx-angular/cdk';\n\n// @NOTICE replace logic with 7v handling of promises in RxJS\n\nexport const promiseTick = () =>\n  new Observable<number>((subscriber) => {\n    let cancelled = false;\n    Promise.resolve()\n      .then(() => {\n        if (!cancelled) {\n          subscriber.next(0);\n          subscriber.complete();\n        }\n      })\n      .catch((e) => {\n        subscriber.error(e);\n      });\n    return () => {\n      cancelled = true;\n      subscriber.complete();\n    };\n  });\n","import { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { RxStrategyProvider } from '@rx-angular/cdk';\n\nimport { Observable, of, Subject } from 'rxjs';\nimport { scan, tap } from 'rxjs/operators';\nimport { priorityTickMap, SchedulingPriority } from './utils';\n\n@Component({\n  selector: 'rxa-scheduling',\n  template: `\n    <rxa-visualizer>\n      <div visualizerHeader>\n        <h2>Scheduling Options</h2>\n        <button mat-raised-button [unpatch] (click)=\"scheduleAllPrios()\">\n          scheduleAll\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio()\">\n          Unscheduled\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.Promise)\">\n          Promise\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.setTimeout)\">\n          setTimeout\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.setInterval)\">\n          setInterval\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.animationFrame)\">\n          animationFrame\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.idleCallback)\">\n          idleCallback\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.background)\">\n          background\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.userVisible)\">\n          userVisible\n        </button>\n        <button mat-raised-button [unpatch] (click)=\"scheduleByPrio(prios.userBlocking)\">\n          userBlocking\n        </button>\n      </div>\n    </rxa-visualizer>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styles: [\n      `\n      button:active {\n        background: red;\n      }\n    `\n  ]\n})\nexport class SchedulingComponent implements OnInit {\n  prios = SchedulingPriority;\n\n  o$ = of(0);\n\n  strategies;\n  nextValues = new Subject<any>();\n  value$: Observable<string> = this.nextValues.pipe(\n    scan(count => ++count),\n    tap(v => console.log('count:', v))\n  );\n  value;\n\n  constructor(private cdRef: ChangeDetectorRef, private strategyProvider: RxStrategyProvider) {\n  }\n\n  scheduleAllPrios() {\n    const sync = () => {\n      this.cdRef.detectChanges();\n    };\n    const micro = () => {\n      this.cdRef.detectChanges();\n    };\n    const setInterval = () => {\n      this.cdRef.detectChanges();\n    };\n    const setTimeout = () => {\n      this.cdRef.detectChanges();\n    };\n    const animationFrame = () => {\n      this.cdRef.detectChanges();\n    };\n    const idleCallback = () => {\n      this.cdRef.detectChanges();\n    };\n    const userBlocking = () => {\n      this.cdRef.detectChanges();\n    };\n    const userVisible = () => {\n      this.cdRef.detectChanges();\n    };\n    const background = () => {\n      this.cdRef.detectChanges();\n    };\n\n    sync();\n    this.strategyProvider.scheduleCD(this.cdRef, {strategy: ''})\n    priorityTickMap[SchedulingPriority.Promise].subscribe(micro);\n    priorityTickMap[SchedulingPriority.setTimeout].subscribe(setTimeout);\n    priorityTickMap[SchedulingPriority.setInterval].subscribe(setInterval);\n    priorityTickMap[SchedulingPriority.animationFrame].subscribe(animationFrame);\n    priorityTickMap[SchedulingPriority.idleCallback].subscribe(idleCallback);\n    priorityTickMap[SchedulingPriority.background].subscribe(background);\n    priorityTickMap[SchedulingPriority.userVisible].subscribe(userVisible);\n    priorityTickMap[SchedulingPriority.userBlocking].subscribe(userBlocking);\n  }\n\n  scheduleByPrio(priority?: SchedulingPriority) {\n    const XXXXXXXXXXXXXXXXXXXXX = () => {\n      this.cdRef.detectChanges();\n      console.log('scheduled over', priority);\n    };\n\n    priority\n      ? priorityTickMap[priority].subscribe(XXXXXXXXXXXXXXXXXXXXX)\n      : XXXXXXXXXXXXXXXXXXXXX();\n  }\n\n  ngOnInit() {\n    this.strategies = this.strategyProvider.strategies;\n  }\n}\n"],"sourceRoot":"webpack:///"}